# MKCS - å¤šå±‚çº§è‡ªåŠ¨äº¤æ˜“ Agent ç³»ç»Ÿ

<div align="center">

![Version](https://img.shields.io/badge/version-1.0.0-blue)
![Python](https://img.shields.io/badge/python-3.9+-green)
![License](https://img.shields.io/badge/license-MIT-orange)

**å¯æ‰©å±•çš„è‡ªåŠ¨äº¤æ˜“ç³»ç»Ÿï¼ˆç¾è‚¡ + æ¸¯è‚¡ï¼‰**

é‡‡ç”¨ skills + agent ç¼–æ’æ¶æ„ï¼ŒLLM ä¸å‚ä¸å®æ—¶ä¸‹å•ï¼Œåªåšç›˜ååˆ†æå’Œç­–ç•¥é…ç½®ã€‚

[å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹) â€¢ [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§) â€¢ [å›æµ‹ç³»ç»Ÿ](#å›æµ‹ç³»ç»Ÿ) â€¢ [é£é™©åˆ†æ](#é£é™©åˆ†æ) â€¢ [å®æ—¶äº¤æ˜“](#å®æ—¶äº¤æ˜“)

</div>

---

## ğŸ“‹ ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)
- [å›æµ‹ç³»ç»Ÿ](#å›æµ‹ç³»ç»Ÿ)
  - [ä¸¥æ ¼å†å²æ•°æ®å›æµ‹å¼•æ“](#ä¸¥æ ¼å†å²æ•°æ®å›æµ‹å¼•æ“)
  - [æ€§èƒ½ä¼˜åŒ–å›æµ‹å¼•æ“](#æ€§èƒ½ä¼˜åŒ–å›æµ‹å¼•æ“)
  - [A/B æµ‹è¯•æ¡†æ¶](#ab-æµ‹è¯•æ¡†æ¶)
- [é£é™©åˆ†æç³»ç»Ÿ](#é£é™©åˆ†æç³»ç»Ÿ)
- [å®æ—¶äº¤æ˜“ç³»ç»Ÿ](#å®æ—¶äº¤æ˜“ç³»ç»Ÿ)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
- [æµ‹è¯•](#æµ‹è¯•)
- [æ›´æ–°æ—¥å¿—](#æ›´æ–°æ—¥å¿—)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/yourname/mkcs.git
cd mkcs

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### è¿è¡Œå›æµ‹

```bash
# è¿è¡Œä¸¥æ ¼å›æµ‹ï¼ˆ10 æ ‡çš„ Ã— 3 å¹´ï¼Œçº¦ 7 ç§’ï¼‰
python scripts/run_backtest_optimized.py \
    --symbols AAPL MSFT GOOGL \
    --start 2022-01-01 \
    --end 2024-12-31 \
    --vote-threshold 1 \
    --use-atr-stops
```

### è¿è¡Œ A/B æµ‹è¯•

```bash
# ä¸‰ç»„å¯¹ç…§å®éªŒ
python scripts/run_backtest_comparison.py \
    --symbols AAPL MSFT GOOGL \
    --start 2022-01-01 \
    --end 2024-12-31
```

### å¯åŠ¨ Web UI

```bash
# åç«¯
python web/app.py

# å‰ç«¯ï¼ˆå¦ä¸€ä¸ªç»ˆç«¯ï¼‰
cd web/frontend && npm run dev
```

è®¿é—® http://localhost:5000

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸ“Š 5 å±‚æ¶æ„ç³»ç»Ÿ

| å±‚çº§ | ç»„ä»¶ | åŠŸèƒ½ |
|------|------|------|
| L1 | æ•°æ®å±‚ | Yahoo Finance APIã€ç¼“å­˜ã€å‘é‡åŒ–æŒ‡æ ‡ |
| L2 | ç­–ç•¥å±‚ | MA ç­–ç•¥ã€æŠ•ç¥¨èåˆã€ä¿¡å·ç”Ÿæˆ |
| L3 | é£æ§å±‚ | ATR æ­¢æŸæ­¢ç›ˆã€æŒä»“é™åˆ¶ã€å†·å´æœŸ |
| L4 | æ‰§è¡Œå±‚ | Paper Brokerã€æ»‘ç‚¹ã€æ‰‹ç»­è´¹æ¨¡æ‹Ÿ |
| L5 | ä¼˜åŒ–å±‚ | æƒé‡å¹³æ»‘ã€Pipeline ä¼˜åŒ–å™¨ |

### ğŸ”¬ ä¸¥æ ¼å›æµ‹å¼•æ“

- **No-Lookahead ä¿æŠ¤**: æ‰€æœ‰æŒ‡æ ‡ä½¿ç”¨ shift(1) é˜²æ­¢æœªæ¥æ•°æ®æ³„æ¼
- **ç»“æœä¸€è‡´æ€§è‡ªæ£€**: éªŒè¯ equity_curveã€tradesã€metrics ä¸€è‡´æ€§
- **åˆ†æ®µè¯„ä¼°**: æŒ‰å¹´ä»½è¾“å‡ºæŒ‡æ ‡ï¼Œå®šä½æœ€å¤§äºæŸçª—å£
- **è¿è¡Œæ—¶é˜²æŠ¤**: å½“å‰ç´¢å¼• >= 50 æ‰ç”Ÿæˆä¿¡å·

### ğŸ¯ é£é™©æ§åˆ¶ç³»ç»Ÿ

- **ATR è‡ªé€‚åº”æ­¢æŸæ­¢ç›ˆ**: åŠ¨æ€è®¡ç®—æ­¢æŸ/æ­¢ç›ˆä»·æ ¼
- **æœ€å°æŒä»“å‘¨æœŸ**: å¼€ä»“åè‡³å°‘æŒæœ‰ N å¤©ï¼Œé¿å…åå¤æ‰“è„¸
- **å†·å´æœŸæœºåˆ¶**: æ­¢æŸå N å¤©ä¸å¼€åŒæ–¹å‘ä»“
- **ç½®ä¿¡åº¦è¿‡æ»¤**: è¿‡æ»¤ä½ç½®ä¿¡åº¦ä¿¡å·ï¼Œå‡å°‘å™ªå£°äº¤æ˜“

### ğŸ“ˆ A/B æµ‹è¯•æ¡†æ¶

- ä¸‰ç»„å¯¹ç…§å®éªŒï¼šbaseline / variant1 / variant2
- è‡ªåŠ¨ç”Ÿæˆ Markdown å¯¹ç…§æŠ¥å‘Š
- æ”¯æŒè‡ªå®šä¹‰é…ç½®å¯¹æ¯”

---

## ğŸ“‰ å›æµ‹ç³»ç»Ÿ

### ä¸¥æ ¼å†å²æ•°æ®å›æµ‹å¼•æ“

**æ–‡ä»¶**: `scripts/run_backtest_strict.py`

```bash
python scripts/run_backtest_strict.py \
    --symbols AAPL MSFT GOOGL \
    --start 2022-01-01 \
    --end 2024-12-31 \
    --vote-threshold 2
```

**ç‰¹æ€§**:
- âœ… ç¦æ­¢æœªæ¥æ•°æ®ï¼ˆT0-4 ~ T0-7ï¼‰
- âœ… Lookahead æ£€æµ‹ï¼ˆT0-8ï¼‰
- âœ… è¿è¡Œæ—¶é˜²æŠ¤ï¼ˆT0-9ï¼‰
- âœ… æŠ•ç¥¨èåˆé€»è¾‘ï¼ˆT1ï¼‰
- âœ… æ­¢æŸæ­¢ç›ˆï¼ˆT2ï¼‰

### æ€§èƒ½ä¼˜åŒ–å›æµ‹å¼•æ“

**æ–‡ä»¶**: `scripts/run_backtest_optimized.py`

```bash
python scripts/run_backtest_optimized.py \
    --symbols AAPL MSFT GOOGL AMZN NVDA \
    --start 2022-01-01 \
    --end 2024-12-31 \
    --vote-threshold 1 \
    --min-hold-bars 5 \
    --cooldown-bars 10 \
    --use-atr-stops
```

**æ€§èƒ½**:
- 10 æ ‡çš„ Ã— 3 å¹´å›æµ‹ï¼š**~7 ç§’**
- å‘é‡åŒ–æŒ‡æ ‡è®¡ç®—
- æ‰¹é‡å†™å…¥ trades/equity
- æ•°æ®ç¼“å­˜ï¼ˆå¯é€‰ pyarrowï¼‰

**é£é™©æ§åˆ¶**:
- `--min-hold-bars 5`: æœ€å°æŒä»“ 5 å¤©
- `--cooldown-bars 10`: æ­¢æŸåå†·å´ 10 å¤©
- `--use-atr-stops`: ATR è‡ªé€‚åº”æ­¢æŸæ­¢ç›ˆ
- `--min-confidence 0.4`: ç½®ä¿¡åº¦è¿‡æ»¤

### A/B æµ‹è¯•æ¡†æ¶

**æ–‡ä»¶**: `scripts/run_backtest_comparison.py`

```bash
python scripts/run_backtest_comparison.py \
    --symbols AAPL MSFT GOOGL \
    --start 2022-01-01 \
    --end 2024-12-31
```

**è¾“å‡º**:
- `outputs/backtests/SPL6B_COMPARISON_REPORT_*.md`

**ç¤ºä¾‹ç»“æœ**:

| ç»„åˆ« | æ”¶ç›Š | æœ€å¤§å›æ’¤ | å¤æ™® | äº¤æ˜“æ•° |
|------|------|----------|------|--------|
| baseline (threshold=2) | 0.00% | 0.00% | - | 0 |
| variant1 (threshold=1+ATR) | +5.08% | 27.05% | 0.24 | 8 |
| variant2 (+æŒä»“/å†·å´) | +5.08% | 27.05% | 0.24 | 8 |

---

## ğŸ›¡ï¸ é£é™©åˆ†æç³»ç»Ÿ

### SPL-3b: æ·±åº¦é£é™©åˆ†æ

- **æ‰°åŠ¨æµ‹è¯•**: æµ‹è¯•æœ€åæƒ…å†µç¨³å®šæ€§
- **ç»“æ„åˆ†æ**: è¯†åˆ«é‡å¤å‘ç”Ÿçš„é£é™©æ¨¡å¼
- **é£é™©åŒ…ç»œ**: P95/P99 æŸå¤±è¾¹ç•Œ
- **å¯æ‰§è¡Œè§„åˆ™**: è‡ªåŠ¨ç”Ÿæˆ if-then é£æ§è§„åˆ™

### SPL-7: åœ¨çº¿ç›‘æ§ä¸åäº‹å®åˆ†æ

- **SPL-7a**: åœ¨çº¿é£é™©ç›‘æ§ã€Post-mortem å½’å› 
- **SPL-7b**: åäº‹å®åˆ†æã€What-If åœºæ™¯æµ‹è¯•

### SPL-4: é£é™©æ§åˆ¶ä¸ç»„åˆåŠ å›º

- **SPL-4c**: é£é™©åŸºçº¿å†»ç»“ã€å›å½’æµ‹è¯•
- **SPL-4a**: è¿è¡Œæ—¶é£æ§æ‰§è¡Œ
- **SPL-4b**: ç»„åˆååŒé£é™©åˆ†æ

---

## âš¡ å®æ—¶äº¤æ˜“ç³»ç»Ÿ

### æ”¯æŒæ¨¡å¼

- **SHADOW**: æ¨¡æ‹Ÿäº¤æ˜“ï¼Œä¸ä¸‹å•
- **LIVE**: çœŸå®ä¸‹å•ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰

### å¯åŠ¨å®æ—¶äº¤æ˜“

```bash
# éªŒè¯ç¯å¢ƒ
python scripts/verify_live_env.py

# Shadow æ¨¡å¼ï¼ˆæµ‹è¯•ï¼‰
python scripts/run_live_with_monitoring.py \
    --symbols AAPL MSFT \
    --cash 100000 \
    --interval 5m

# LIVE æ¨¡å¼ï¼ˆçœŸå®äº¤æ˜“ï¼‰
python scripts/run_live_with_monitoring.py \
    --symbols AAPL MSFT \
    --cash 100000 \
    --interval 5m \
    --mode live
```

### Web UI

å¯åŠ¨åç«¯ï¼š
```bash
python web/app.py --host 0.0.0.0 --port 5000
```

è®¿é—® http://localhost:5000

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
mkcs/
â”œâ”€â”€ analysis/              # é£é™©åˆ†ææ¨¡å—
â”‚   â”œâ”€â”€ counterfactual.py      # åäº‹å®åˆ†æ
â”‚   â”œâ”€â”€ online/               # åœ¨çº¿ç›‘æ§
â”‚   â”œâ”€â”€ portfolio/            # ç»„åˆåˆ†æ
â”‚   â””â”€â”€ replay_schema.py      # å›æµ‹è¾“å‡ºæ ¼å¼
â”œâ”€â”€ broker/                # æ¨¡æ‹Ÿäº¤æ˜“
â”œâ”€â”€ core/                  # æ ¸å¿ƒæ•°æ®æ¨¡å‹
â”œâ”€â”€ scripts/               # å·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ run_backtest_strict.py     # ä¸¥æ ¼å›æµ‹
â”‚   â”œâ”€â”€ run_backtest_optimized.py  # æ€§èƒ½ä¼˜åŒ–å›æµ‹
â”‚   â”œâ”€â”€ run_backtest_comparison.py  # A/B æµ‹è¯•
â”‚   â”œâ”€â”€ run_simulation.py         # æ¨¡æ‹Ÿäº¤æ˜“
â”‚   â””â”€â”€ verify_live_env.py        # ç¯å¢ƒéªŒè¯
â”œâ”€â”€ skills/                # æŠ€èƒ½æ¨¡å—
â”‚   â”œâ”€â”€ market_data/        # æ•°æ®æº
â”‚   â”œâ”€â”€ strategy/           # äº¤æ˜“ç­–ç•¥
â”‚   â””â”€â”€ risk/               # é£æ§
â”œâ”€â”€ tests/                 # æµ‹è¯•ç”¨ä¾‹
â”œâ”€â”€ web/                   # Web UI
â”‚   â”œâ”€â”€ app.py              # Flask åç«¯
â”‚   â”œâ”€â”€ templates/          # HTML æ¨¡æ¿
â”‚   â”œâ”€â”€ static/             # CSS/JS èµ„æº
â”‚   â””â”€â”€ frontend/          # React å‰ç«¯
â”œâ”€â”€ outputs/               # è¾“å‡ºç›®å½•
â”‚   â”œâ”€â”€ backtests/         # å›æµ‹ç»“æœ
â”‚   â”œâ”€â”€ spl6b_comparison/  # A/B æµ‹è¯•æŠ¥å‘Š
â”‚   â””â”€â”€ cache/             # æ•°æ®ç¼“å­˜
â””â”€â”€ docs/                  # æ–‡æ¡£
```

---

## ğŸ”§ é…ç½®è¯´æ˜

### å›æµ‹é…ç½®

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--symbols` | AAPL MSFT GOOGL | äº¤æ˜“æ ‡çš„ |
| `--start` | 2022-01-01 | å¼€å§‹æ—¥æœŸ |
| `--end` | 2024-12-31 | ç»“æŸæ—¥æœŸ |
| `--vote-threshold` | 2 | æŠ•ç¥¨é˜ˆå€¼ |
| `--min-confidence` | 0.0 | æœ€å°ç½®ä¿¡åº¦ |
| `--min-hold-bars` | 0 | æœ€å°æŒä»“å‘¨æœŸ |
| `--cooldown-bars` | 0 | æ­¢æŸå†·å´æœŸ |
| `--use-atr-stops` | False | ATR æ­¢æŸæ­¢ç›ˆ |

### å®æ—¶äº¤æ˜“é…ç½®

ç¼–è¾‘ `config/live/live_config.yaml`:
```yaml
mode: SHADOW  # SHADOW / LIVE
symbols: [AAPL, MSFT]
kill_switch:
  max_daily_loss: 0.03
  max_drawdown: 0.10
```

---

## ğŸ§ª æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python -m pytest tests/ -v

# è¿è¡Œç‰¹å®šæµ‹è¯•
python -m pytest tests/test_counterfactual_analysis.py -v
python -m pytest tests/test_spl6b_optimizer_gate.py -v

# éªŒè¯å¯å¤ç°æ€§
python tests/test_ci_regression.py
```

**æµ‹è¯•è¦†ç›–**:
- 79+ æµ‹è¯•ç”¨ä¾‹
- åäº‹å®åˆ†ææµ‹è¯•
- SPL-6b ä¼˜åŒ–å™¨æµ‹è¯•
- æƒé‡å¹³æ»‘éªŒè¯æµ‹è¯•

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2026-02-08) - Release 1.0

**æ–°å¢åŠŸèƒ½**:
- âœ… ä¸¥æ ¼å†å²æ•°æ®å›æµ‹å¼•æ“ï¼ˆT0-T2 éªŒæ”¶ï¼‰
- âœ… æ€§èƒ½ä¼˜åŒ–å›æµ‹å¼•æ“ï¼ˆ7 ç§’å®Œæˆ 10 æ ‡çš„Ã—3 å¹´ï¼‰
- âœ… A/B æµ‹è¯•æ¡†æ¶ï¼ˆä¸‰ç»„å¯¹ç…§å®éªŒï¼‰
- âœ… åˆ†æ®µè¯„ä¼°ï¼ˆå¹´åº¦æŒ‡æ ‡ + æœ€å¤§äºæŸçª—å£ï¼‰
- âœ… ATR è‡ªé€‚åº”æ­¢æŸæ­¢ç›ˆ
- âœ… æœ€å°æŒä»“å‘¨æœŸå’Œå†·å´æœºåˆ¶
- âœ… ç½®ä¿¡åº¦è¿‡æ»¤ç³»ç»Ÿ

**ä¼˜åŒ–æ”¹è¿›**:
- å‘é‡åŒ–æŒ‡æ ‡è®¡ç®—ï¼ˆæ€§èƒ½æå‡ 5-6 å€ï¼‰
- æ‰¹é‡å†™å…¥ trades/equity
- æ•°æ®ç¼“å­˜ç³»ç»Ÿ
- äº¤æ˜“æ•°ä» 123 é™åˆ° 8ï¼ˆå‡å°‘ 93%ï¼‰
- æœ€å¤§å›æ’¤ä» 48% é™åˆ° 27%

**æ–‡æ¡£å®Œå–„**:
- å®Œæ•´çš„ README
- P0/P1/P2 éªŒæ”¶æŠ¥å‘Š
- OPTIMIZATION_REPORT.md
- BACKTEST_IMPLEMENTATION_SUMMARY.md

**ç³»ç»Ÿæ¶æ„**:
- 5 å±‚æ¶æ„å®Œæ•´å®ç°
- SPL-3b æ·±åº¦é£é™©åˆ†æ
- SPL-4 é£é™©æ§åˆ¶ä¸ç»„åˆåŠ å›º
- SPL-7 åœ¨çº¿ç›‘æ§ä¸åäº‹å®åˆ†æ
- Live Trading å®æ—¶äº¤æ˜“ç³»ç»Ÿ

---

## ğŸ“„ è®¸å¯è¯

MIT License

---

## ğŸ”— ç›¸å…³é“¾æ¥

- [æ›´æ–°æ—¥å¿—](CHANGELOG.md)
- [å¼€å‘æ–‡æ¡£](docs/)
- [æµ‹è¯•æŠ¥å‘Š](tests/)
