# MKCS ç­–ç•¥æ”¹è¿›å¼€å‘æ—¥å¿—

## 2026-02-06 - Phase 1 å®Œæˆï¼šç­–ç•¥è¾“å‡ºä¸æ¥å£è§„èŒƒåŒ–

### æ–°å¢æ–‡ä»¶

#### 1. `core/strategy_models.py` - æ ¸å¿ƒç­–ç•¥æ¨¡å‹
- **RegimeType**: å¸‚åœºçŠ¶æ€æšä¸¾ (TREND, RANGE, HIGH_VOL, LOW_VOL, UNKNOWN)
- **RiskHints**: é£é™©æç¤ºæ•°æ®ç±» (æ­¢æŸã€æ­¢ç›ˆã€ç§»åŠ¨æ­¢æŸç­‰)
- **StrategySignal**: ç»Ÿä¸€ç­–ç•¥ä¿¡å·è¾“å‡º
  - `target_position`: ç›®æ ‡æŒä»“æ•°é‡
  - `target_weight`: ç›®æ ‡æƒé‡ (-1 åˆ° 1)
  - `confidence`: ç½®ä¿¡åº¦
  - `regime`: å½“å‰å¸‚åœºçŠ¶æ€
  - `risk_hints`: é£é™©æç¤º
- **StrategyState**: ç­–ç•¥çŠ¶æ€ï¼ˆæ”¯æŒåºåˆ—åŒ–ï¼‰
- **StatefulStrategy**: æœ‰çŠ¶æ€ç­–ç•¥æ¥å£
- **RegimeInfo**: å¸‚åœºçŠ¶æ€ä¿¡æ¯

#### 2. `skills/analysis/regime_detector.py` - å¸‚åœºçŠ¶æ€æ£€æµ‹å™¨
- **RegimeDetector**: å¸‚åœºçŠ¶æ€æ£€æµ‹å™¨
  - ADX è®¡ç®—ï¼ˆè¶‹åŠ¿å¼ºåº¦ï¼‰
  - ATR è®¡ç®—ï¼ˆæ³¢åŠ¨ç‡ï¼‰
  - éœ‡è¡åŒºé—´æ£€æµ‹
  - RSI è®¡ç®—
  - ç»¼åˆåˆ¤å®šå¸‚åœºçŠ¶æ€
- **RegimeState**: å¸‚åœºçŠ¶æ€å†å²è®°å½•
- **is_regime_allowed()**: ç­–ç•¥ gating åˆ¤æ–­
- **get_regime_position_modifier()**: æ ¹æ®å¸‚åœºçŠ¶æ€è°ƒæ•´ä»“ä½

ç­–ç•¥ Gating é…ç½®ï¼š
| ç­–ç•¥    | TREND | RANGE | HIGH_VOL | LOW_VOL | UNKNOWN |
|---------|-------|-------|----------|---------|---------|
| MA      | âœ…    | âŒ    | âŒ       | âœ…      | âŒ      |
| Breakout| âœ…    | âŒ    | âœ…       | âŒ      | âŒ      |
| ML      | âœ…    | âœ…    | âŒ       | âœ…      | âœ…      |

#### 3. `skills/strategy/enhanced_base.py` - å¢å¼ºç­–ç•¥åŸºç±»
- **EnhancedStrategy**: æ‰€æœ‰æ–°ç­–ç•¥çš„åŸºç±»
  - æ”¯æŒ StrategySignal è¾“å‡º
  - å¸‚åœºçŠ¶æ€æ„ŸçŸ¥
  - è‡ªåŠ¨ regime gating
  - è¿ç»­ä»“ä½ sizing
  - å‘åå…¼å®¹æ—§ Signal æ¥å£
- **AdaptiveMixin**: è‡ªé€‚åº”ç­–ç•¥æ··å…¥ç±»

#### 4. `skills/strategy/enhanced_ma.py` - å¢å¼ºç‰ˆ MA ç­–ç•¥
- ç»§æ‰¿ EnhancedStrategy
- æ”¯æŒå¸‚åœºçŠ¶æ€ gating
- è¿ç»­ä»“ä½ sizingï¼ˆåŸºäºä¿¡å·å¼ºåº¦å’Œæ³¢åŠ¨ç‡ï¼‰
- åŠ¨æ€æ­¢ç›ˆæ­¢æŸï¼ˆtrailing stopï¼‰
- å®Œæ•´çš„çŠ¶æ€ç®¡ç†

### Phase 1 éªŒæ”¶æ ‡å‡†è¾¾æˆ

- âœ… agent/runner å±‚ä¸å†ä¾èµ–ç­–ç•¥å†…éƒ¨ç»†èŠ‚ï¼ˆé€šè¿‡ StrategySignal ç»Ÿä¸€æ¥å£ï¼‰
- âœ… ç­–ç•¥è¾“å‡ºå¯ç›´æ¥åºåˆ—åŒ–å¹¶å†™å…¥ event log
- âœ… åŒä¸€æ•°æ® replay å¤šæ¬¡ï¼Œç­–ç•¥è¾“å‡ºå®Œå…¨ä¸€è‡´ï¼ˆé€šè¿‡ StrategyStateï¼‰

### Phase 2 è¿›è¡Œä¸­ï¼šéœ‡è¡å¸‚äºæŸæ²»ç†

- âœ… RegimeDetector å·²å®ç°
- âœ… Regime â†’ ç­–ç•¥ gating æœºåˆ¶å·²å®ç°
- ğŸ”„ è¿ç»­ä»“ä½ sizingï¼ˆå·²å®ç°æ¡†æ¶ï¼Œéœ€åœ¨å„ç­–ç•¥ä¸­å®Œå–„ï¼‰
- ğŸ”„ åŠ¨æ€æ­¢ç›ˆæ­¢æŸï¼ˆå·²å®ç° trailing stopï¼Œéœ€åˆ†æ‰¹æ­¢ç›ˆï¼‰

### ä¸‹ä¸€æ­¥å·¥ä½œ

1. **Phase 2-T3**: å®Œå–„ BreakoutStrategy çš„å¢å¼ºç‰ˆ
2. **Phase 2-T4**: å®ç°åˆ†æ‰¹æ­¢ç›ˆé€»è¾‘
3. **Phase 3**: çªç ´ç­–ç•¥ç¨³å¥æ€§å¢å¼º
4. **Phase 4**: ML ç­–ç•¥å·¥ç¨‹åŒ–

### æµ‹è¯•ç»“æœ

```
=== Strategy Models æµ‹è¯• ===
âœ… RiskHints åºåˆ—åŒ–/ååºåˆ—åŒ–
âœ… StrategySignal åˆ›å»ºå’Œè½¬æ¢
âœ… StrategyState æŒä¹…åŒ–

=== RegimeDetector æµ‹è¯• ===
âœ… è¶‹åŠ¿å¸‚æ£€æµ‹ (ADX=64.27, ç½®ä¿¡åº¦=0.95)
âœ… éœ‡è¡å¸‚æ£€æµ‹ (ADX=19.73, ç½®ä¿¡åº¦=0.40)
âœ… çŠ¶æ€å†å²è·Ÿè¸ª
âœ… ç­–ç•¥ Gating åˆ¤æ–­
âœ… ä»“ä½è°ƒæ•´ç³»æ•°è®¡ç®—
```
