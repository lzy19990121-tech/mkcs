# SPL-6 éªŒæ”¶æŠ¥å‘Š

**éªŒæ”¶æ—¥æœŸ**: 2026-02-01
**éªŒæ”¶äºº**: Claude Code

---

## ğŸ“Š æ€»ä½“è¯„åˆ†

| æ¨¡å— | å®Œæˆåº¦ | çŠ¶æ€ |
|------|--------|------|
| SPL-6a (Drift Detection) | ~70% | âš ï¸  éƒ¨åˆ†å®Œæˆ |
| SPL-6b (Allocator v2) | ~50% | âš ï¸  æ ¸å¿ƒç¼ºå¤± |
| **SPL-6 æ€»ä½“** | **~60%** | **âŒ æœªé€šè¿‡éªŒæ”¶** |

---

## ğŸ§­ SPL-6a: Drift Detection & Controlled Recalibration

### âœ… A1. æ¼‚ç§»å¯¹è±¡å®šä¹‰å®Œæ•´ (95%)

| å­é¡¹ | çŠ¶æ€ | è¯æ® |
|------|------|------|
| è¾“å…¥åˆ†å¸ƒè¦†ç›– | âœ… | drift_objects.yaml: returns, volatility, adx, spread_cost |
| é£é™©è¡Œä¸ºè¦†ç›– | âœ… | worst_case_returns, cvar, max_drawdown, drawdown_duration, spike_metrics |
| è§„åˆ™/ç»„åˆè¦†ç›– | âœ… | gating_trigger_rate, avg_downtime, portfolio_correlation, co_crash_frequency |
| å£å¾„ä¸ SPL-4/5 ä¸€è‡´ | âš ï¸  | çª—å£å®šä¹‰ä¸€è‡´ï¼Œä½†æœªæ˜¾å¼ç‰ˆæœ¬åŒ–å…³è” |

### âœ… A2. æ¼‚ç§»æŒ‡æ ‡å¯è§£é‡Š (90%)

| å­é¡¹ | çŠ¶æ€ | è¯æ® |
|------|------|------|
| è¾“å…¥åˆ†å¸ƒ â‰¥2 ç§æŒ‡æ ‡ | âœ… | PSI, JS divergence, KS test, Wasserstein, bucket_shift |
| é£é™©è¡Œä¸ºæ»šåŠ¨å¯¹æ¯” | âœ… | percentile_shift, tail_change, absolute_change, relative_change |
| è§„åˆ™/ç»„åˆåˆ†å¸ƒå˜åŒ– | âœ… | gating_trigger_rate, co_crash_frequency |
| æŒ‡æ ‡å¯å¤ç°ã€å¯å®¡è®¡ | âœ… | DriftSnapshot, DriftResult æ•°æ®ç»“æ„ |

### âœ… A3. æ¼‚ç§»åˆ†çº§ä¸é˜ˆå€¼æ˜ç¡® (85%)

| å­é¡¹ | çŠ¶æ€ | è¯æ® |
|------|------|------|
| GREEN/YELLOW/RED/CRITICAL | âœ… | DriftStatus enum å®šä¹‰ |
| æ¯ç±»å¯¹è±¡æœ‰æ˜ç¡®é˜ˆå€¼ | âœ… | drift_thresholds.yaml å®Œæ•´é…ç½® |
| é˜ˆå€¼ç‰ˆæœ¬åŒ– | âœ… | YAML é…ç½®æ–‡ä»¶ |
| è¿ç»­ N æ¬¡è§¦å‘è§„åˆ™ | âœ… | consecutive_red: count=3, window_days=7 |

### âš ï¸ A4. å—æ§å†æ ‡å®šæµç¨‹æˆç«‹ (70%)

| å­é¡¹ | çŠ¶æ€ | è¯æ® |
|------|------|------|
| RED ä¸”æ»¡è¶³æ¡ä»¶æ‰è§¦å‘ | âœ… | check_recalibration_trigger() å®ç° |
| çœŸå®æ•°æ® + eligibility | âœ… | DataEligibilityFilter, TimeSeriesSplitter |
| æ—¶é—´åˆ‡åˆ† train/valid | âœ… | æ— éšæœºæ‰“æ•£ï¼Œä¸¥æ ¼æ—¶é—´åˆ‡åˆ† |
| è¾“å‡ºå€™é€‰ï¼ˆä¸è¦†ç›–ï¼‰ | âœ… | ç”Ÿæˆ candidate_params.json |

### âŒ A5. å†æ ‡å®šå€™é€‰çš„ç¡¬é—¨æ§› (30%)

| å­é¡¹ | çŠ¶æ€ | é—®é¢˜ |
|------|------|------|
| é€šè¿‡ SPL-4/5 regression gates | âŒ | **æœªå®ç°** - ControlledRecalibrationPipeline æœªè°ƒç”¨ gates |
| ä¸‰ç»„å¯¹ç…§æŠ¥å‘Š | âŒ | **æœªå®ç°** - No/SPL-4/Candidate å¯¹æ¯”ç¼ºå¤± |
| envelope/spike/co-crash ä¸é€€åŒ– | âŒ | **æœªéªŒè¯** - ç¼ºå°‘ regression é›†æˆ |
| å¤±è´¥ä¸å½±å“ baseline | âœ… | candidate_params.json æ˜¯ç‹¬ç«‹æ–‡ä»¶ |

**ä¸¥é‡ç¼ºé™·**: å†æ ‡å®šæµç¨‹æœªä¸ SPL-4/5 regression gates é›†æˆï¼Œæ— æ³•ä¿è¯å€™é€‰å‚æ•°çš„å®‰å…¨æ€§ã€‚

### âš ï¸ A6. è‡ªåŠ¨åŒ–ä¸å®¡è®¡ (50%)

| å­é¡¹ | çŠ¶æ€ | é—®é¢˜ |
|------|------|------|
| drift report å®šæ—¶ç”Ÿæˆ | âœ… | spl6a_drift_detection_simple.py å¯é›†æˆåˆ° cron/CI |
| RED ç”Ÿæˆ PR/å·¥å• | âš ï¸  | æœ‰ "create_recalibration_ticket" è§¦å‘å™¨ï¼Œä½†æœªå®ç°å…·ä½“é€»è¾‘ |
| baseline æ›´æ–° PR æ¨¡æ¿ | âŒ | **ç¼ºå¤±** - æ²¡æœ‰ä¸“ç”¨ PR æ¨¡æ¿æˆ–å®¡æ‰¹æµç¨‹ |
| å®¡è®¡ä¿¡æ¯é½å…¨ | âš ï¸  | æœ‰ timestamp/details å­—æ®µï¼Œä½†ä¸å®Œæ•´ï¼ˆç¼ºå°‘ who/approvalï¼‰ |

---

## ğŸ§© SPL-6b: Allocator v2 (Constrained Optimization)

### âœ… B1. ä¼˜åŒ–é—®é¢˜å®šä¹‰æ¸…æ™° (90%)

| å­é¡¹ | çŠ¶æ€ | è¯æ® |
|------|------|------|
| å†³ç­–å˜é‡æ˜ç¡® | âœ… | strategy_weights: continuous [0,1] |
| ç›®æ ‡å‡½æ•°æ˜ç¡® | âœ… | maximize w^T * mu - minimize risk + penalties |
| ç¡¬çº¦æŸæ¥è‡ª risk budget | âœ… | P95/P99 (-10%/-15%), MDD (12%), duration (20å¤©) |
| leverage/cap/æ€»æƒé‡ | âœ… | weight_bounds [0,1], sum_weights=1.0, max_single=0.4 |

### âœ… B2. é£é™©ä»£ç†åˆç† (85%)

| å­é¡¹ | çŠ¶æ€ | è¯æ® |
|------|------|------|
| å¯ä¼˜åŒ–çš„ risk surrogate | âœ… | CVaR, variance, semi-variance, tail correlation |
| å‹åŠ›æœŸæ ·æœ¬é€‰æ‹© | âœ… | worst windows (SPL-4), weight=2x |
| ååŒçˆ†ç‚¸ proxy çº¦æŸ | âœ… | tail_correlation_limit (0.5), co_crash_limit (2) |

### âš ï¸ B3. ä¼˜åŒ–å™¨å®ç°å¯æ§ (70%)

| å­é¡¹ | çŠ¶æ€ | é—®é¢˜ |
|------|------|------|
| ç¨³å®šæ±‚è§£æˆ– fallback | âœ… | scipy.optimize SLSQP + FallbackAllocator |
| æƒé‡å¹³æ»‘/æ¢æ‰‹æƒ©ç½š | âš ï¸  | **é…ç½®æœ‰ä½†æœªå®ç°** - smoothness_penalty æœªç”¨äºç›®æ ‡å‡½æ•° |
| è¯Šæ–­ä¿¡æ¯ | âœ… | binding_constraints, constraint_violations, iterations |

### âŒ B4. æ‰§è¡Œé¡ºåºæ­£ç¡® (20%)

| å­é¡¹ | çŠ¶æ€ | é—®é¢˜ |
|------|------|------|
| é¡ºåºå›ºå®šä¸”æ–‡æ¡£åŒ– | âŒ | **ç¼ºå¤±** - `analysis/pipeline_optimizer_v2.py` ä¸å­˜åœ¨ |
| gating â†’ optimizer â†’ normalize | âŒ | **æœªå®ç°** - æ—  Pipeline é›†æˆ |
| ä¸ eligible ä¸è¿›ä¼˜åŒ–å™¨ | âŒ | **æœªå®ç°** - gating è¿‡ç¨‹æœªè¿æ¥ |

**ä¸¥é‡ç¼ºé™·**: SPL-6b-D æ ‡è®°ä¸ºå®Œæˆï¼Œä½† `pipeline_optimizer_v2.py` æ–‡ä»¶å®Œå…¨ä¸å­˜åœ¨ã€‚Gating ä¸ Optimizer æœªé›†æˆã€‚

### âŒ B5. ä¸‰ç»„ç»„åˆå¯¹ç…§å®Œæˆ (10%)

| å­é¡¹ | çŠ¶æ€ | é—®é¢˜ |
|------|------|------|
| SPL-5b rules (baseline) | âŒ | **æœªå®ç°** |
| SPL-6b optimizer | âŒ | **æœªå®ç°** |
| SPL-5a + SPL-6b | âŒ | **æœªå®ç°** |
| åŒä¸€æ•°æ®æºã€åŒä¸€è¯„ä¼°çª—å£ | âŒ | **æœªå®ç°** |

**ä¸¥é‡ç¼ºé™·**: `scripts/spl6b_comparison.py` æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¸‰ç»„å¯¹ç…§å®éªŒæœªå®ç°ã€‚

### âš ï¸ B6. é£é™©ä¸é€€åŒ– (40%)

| å­é¡¹ | çŠ¶æ€ | é—®é¢˜ |
|------|------|------|
| ç»„åˆ worst-case ä¸çªç ´ | âš ï¸  | çº¦æŸå·²å®šä¹‰ï¼Œä½†**æœªé€šè¿‡çœŸå®æ•°æ®éªŒè¯** |
| correlation spike/co-crash | âš ï¸  | çº¦æŸå·²å®šä¹‰ï¼Œä½†**æœªéªŒè¯ guard æ•ˆæœ** |
| æƒé‡æŠ–åŠ¨åœ¨é˜ˆå€¼å†… | âš ï¸  | æœ‰ max_weight_changeï¼Œä½†**æœªæµ‹è¯•** |
| æ”¶ç›Š/ç¨³å®šæ€§æ”¹è¿› | âŒ | **æœªè¯„ä¼°** - ç¼ºå°‘å¯¹æ¯”å®éªŒ |

### âŒ B7. å›å½’ä¸é™çº§ç­–ç•¥ (30%)

| å­é¡¹ | çŠ¶æ€ | é—®é¢˜ |
|------|------|------|
| optimizer regression tests | âŒ | **æœªå®ç°** - æ²¡æœ‰ä¸“é—¨çš„ optimizer CI gate |
| FAIL é˜»æ–­ PR | âŒ | **æœªå®ç°** - æ—  optimizer regression å·¥ä½œæµ |
| é™çº§ç­–ç•¥æ˜ç¡® | âœ… | FallbackAllocator (inverse variance) |
| è¯Šæ–­æŠ¥å‘Š artifact | âš ï¸  | æœ‰è¯Šæ–­ä¿¡æ¯ï¼Œä½†**æœªé›†æˆåˆ° CI artifact** |

---

## ğŸ”š SPL-6 æ€»éªŒæ”¶ï¼ˆç»ˆæ£€ï¼‰

### âŒ æ— æ³•ç›´æ¥å›ç­”çš„å…³é”®é—®é¢˜

| é—®é¢˜ | èƒ½å›ç­”? | å®é™…æƒ…å†µ |
|------|---------|----------|
| ä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘å†æ ‡å®šï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ | âš ï¸  éƒ¨åˆ† | çŸ¥é“è§¦å‘æ¡ä»¶ï¼ˆRED + è¿ç»­3æ¬¡ï¼‰ï¼Œä½†**æœªéªŒè¯æ˜¯å¦ç”Ÿæ•ˆ** |
| æ–°å‚æ•°ä¸ºä½•å¯ä¿¡ï¼Ÿè¯æ®åœ¨å“ªï¼Ÿ | âŒ | **æ— æ³•å›ç­”** - ç¼ºå°‘ä¸‰ç»„å¯¹ç…§æŠ¥å‘Šå’Œ regression gates |
| ä¼˜åŒ–å™¨å—å“ªäº›ç¡¬çº¦æŸï¼Ÿæœ€ç´§çš„æ˜¯å“ªæ¡ï¼Ÿ | âš ï¸  éƒ¨åˆ† | çº¦æŸå·²å®šä¹‰ï¼Œä½†**æœªæ±‚è§£è¿‡çœŸå®é—®é¢˜ï¼Œä¸çŸ¥é“å“ªæ¡æœ€ç´§** |
| å¦‚æœä¼˜åŒ–å¤±è´¥ï¼Œç³»ç»Ÿå¦‚ä½•å®‰å…¨é™çº§ï¼Ÿ | âœ… | æœ‰ FallbackAllocatorï¼ˆæ–¹å·®å€’æ•°ï¼‰ |
| ä»»æ„æ”¹åŠ¨æ˜¯å¦éƒ½ä¼šè¢« CI gate å®ˆä½ï¼Ÿ | âŒ | **æ— æ³•ä¿è¯** - optimizer regression tests æœªå®ç° |

---

## ğŸš¨ é˜»å¡é—®é¢˜æ¸…å•ï¼ˆP0ï¼‰

### SPL-6a é˜»å¡é—®é¢˜

1. **[P0-A5] å†æ ‡å®šæœªä¸ regression gates é›†æˆ**
   - æ–‡ä»¶: `scripts/spl6a_controlled_recalibration.py`
   - é—®é¢˜: `ControlledRecalibrationPipeline` æœªè°ƒç”¨ SPL-4/5 regression tests
   - å½±å“: å€™é€‰å‚æ•°æ— æ³•éªŒè¯å®‰å…¨æ€§ï¼Œå¯èƒ½å¯¼è‡´åœ¨çº¿æ€§èƒ½é€€åŒ–
   - ä¿®å¤: éœ€è¦æ·»åŠ  regression gates è°ƒç”¨å’Œä¸‰ç»„å¯¹ç…§æŠ¥å‘Š

2. **[P0-A6] ç¼ºå°‘ baseline æ›´æ–°å®¡æ‰¹æµç¨‹**
   - æ–‡ä»¶: N/A
   - é—®é¢˜: æ²¡æœ‰ PR æ¨¡æ¿æˆ–å®¡æ‰¹æœºåˆ¶
   - å½±å“: baseline å¯èƒ½è¢«æ„å¤–ä¿®æ”¹ï¼Œæ— å®¡è®¡è¿½è¸ª
   - ä¿®å¤: åˆ›å»º PR æ¨¡æ¿å’Œå®¡æ‰¹ workflow

### SPL-6b é˜»å¡é—®é¢˜

3. **[P0-B4] Pipeline é›†æˆæ–‡ä»¶ä¸å­˜åœ¨**
   - æ–‡ä»¶: `analysis/pipeline_optimizer_v2.py`
   - é—®é¢˜: æ–‡ä»¶åœ¨æ–‡æ¡£ä¸­æ ‡è®°ä¸ºå®Œæˆï¼Œä½†å®é™…ä¸å­˜åœ¨
   - å½±å“: Gating ä¸ Optimizer å®Œå…¨æœªé›†æˆï¼Œæ— æ³•ä½¿ç”¨
   - ä¿®å¤: å®ç° pipeline é›†æˆï¼ˆgating â†’ optimizer â†’ normalizationï¼‰

4. **[P0-B5] ä¸‰ç»„å¯¹ç…§å®éªŒæœªå®ç°**
   - æ–‡ä»¶: `scripts/spl6b_comparison.py`
   - é—®é¢˜: æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ— æ³•è¯„ä¼°ä¼˜åŒ–å™¨æ•ˆæœ
   - å½±å“: æ— æ³•è¯æ˜ä¼˜åŒ–å™¨ä¼˜äºè§„åˆ™åˆ†é…
   - ä¿®å¤: å®ç°ä¸‰ç»„å¯¹ç…§æ¡†æ¶å’Œè¯„ä¼°è„šæœ¬

5. **[P0-B7] ç¼ºå°‘ optimizer regression CI gate**
   - æ–‡ä»¶: `.github/workflows/optimizer_regression.yml`
   - é—®é¢˜: æ²¡æœ‰ CI å·¥ä½œæµä¿æŠ¤ä¼˜åŒ–å™¨
   - å½±å“: æœ‰é—®é¢˜çš„ä¼˜åŒ–å™¨å¯èƒ½è¢«åˆå¹¶åˆ°ä¸»åˆ†æ”¯
   - ä¿®å¤: åˆ›å»º optimizer regression workflow

---

## ğŸ“‹ å»ºè®®çš„ä¿®å¤è®¡åˆ’

### Phase 1: ä¿®å¤ SPL-6b é˜»å¡é—®é¢˜ï¼ˆä¼˜å…ˆï¼‰

**ä»»åŠ¡ 1**: å®ç° `analysis/pipeline_optimizer_v2.py`
- é¡ºåº: Gating â†’ Optimizer â†’ Normalization â†’ Smoothing
- å¤ç”¨ SPL-5a gating é€»è¾‘
- åªå¯¹ eligible ç­–ç•¥ä¼˜åŒ–
- æˆæœ¬ä¿®æ­£å’Œæƒé‡å¹³æ»‘

**ä»»åŠ¡ 2**: å®ç° `scripts/spl6b_comparison.py`
- ä¸‰ç»„å¯¹ç…§: SPL-5b rules / SPL-6b optimizer / SPL-5a+6b
- åŒæ•°æ®æºã€åŒè¯„ä¼°çª—å£
- ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Š

**ä»»åŠ¡ 3**: åˆ›å»º `.github/workflows/optimizer_regression.yml`
- optimizer non-regression tests
- binding_constraint sanity checks
- stability guard tests
- FAIL é˜»æ–­ PR

### Phase 2: ä¿®å¤ SPL-6a é˜»å¡é—®é¢˜

**ä»»åŠ¡ 4**: å¢å¼º `scripts/spl6a_controlled_recalibration.py`
- é›†æˆ SPL-4/5 regression gates
- ç”Ÿæˆä¸‰ç»„å¯¹ç…§æŠ¥å‘Š
- åªé€šè¿‡ gates çš„å€™é€‰æ‰èƒ½æ›´æ–° baseline

**ä»»åŠ¡ 5**: åˆ›å»º baseline æ›´æ–° PR æ¨¡æ¿
- `.github/PULL_REQUEST_TEMPLATE/rebaseline.md`
- å¼ºåˆ¶å¡«å†™æ›´æ–°ç†ç”±ã€è¯æ®ã€å®¡æ‰¹äºº
- é›†æˆåˆ° CI check

### Phase 3: å®Œå–„åŠŸèƒ½ï¼ˆP1-P2ï¼‰

**ä»»åŠ¡ 6**: å®ç°æƒé‡å¹³æ»‘æƒ©ç½š
- åœ¨ä¼˜åŒ–ç›®æ ‡å‡½æ•°ä¸­æ·»åŠ  smoothness_penalty
- æµ‹è¯•æƒé‡æŠ–åŠ¨æŠ‘åˆ¶æ•ˆæœ

**ä»»åŠ¡ 7**: æ·»åŠ å®¡è®¡å­—æ®µ
- who, when, why, evidence, approval
- å®Œæ•´çš„å®¡è®¡è¿½è¸ª

**ä»»åŠ¡ 8**: ç‰ˆæœ¬åŒ–é…ç½®å…³è”
- æ˜¾å¼æ ‡è®°ä¸ SPL-4/5 çš„ä¾èµ–ç‰ˆæœ¬
- é…ç½®å…¼å®¹æ€§æ£€æŸ¥

---

## âœ… éªŒæ”¶ç»“è®º

**å½“å‰çŠ¶æ€**: âŒ **SPL-6 æœªé€šè¿‡éªŒæ”¶**

**æ ¸å¿ƒåŸå› **:
1. SPL-6b æ ¸å¿ƒæ–‡ä»¶ç¼ºå¤±ï¼ˆpipeline é›†æˆã€ä¸‰ç»„å¯¹ç…§ï¼‰
2. SPL-6a å†æ ‡å®šæœªä¸ regression gates é›†æˆ
3. ç¼ºå°‘ optimizer regression CI ä¿æŠ¤
4. æ— æ³•è¯æ˜ä¼˜åŒ–å™¨ä¸åŠ£åŒ–æ€§èƒ½

**å»ºè®®è¡ŒåŠ¨**:
1. å®Œæˆ Phase 1 ä¿®å¤ï¼ˆ3 ä¸ªä»»åŠ¡ï¼‰åï¼Œé‡æ–°éªŒæ”¶ SPL-6b
2. å®Œæˆ Phase 2 ä¿®å¤ï¼ˆ2 ä¸ªä»»åŠ¡ï¼‰åï¼Œé‡æ–°éªŒæ”¶ SPL-6a
3. Phase 3 å¯åœ¨åç»­è¿­ä»£ä¸­å®Œå–„

**ä¼°ç®—ä¿®å¤æ—¶é—´**:
- Phase 1: 3-4 å°æ—¶
- Phase 2: 2-3 å°æ—¶
- Phase 3: 2-3 å°æ—¶
- æ€»è®¡: 7-10 å°æ—¶

---

**ç”Ÿæˆæ—¶é—´**: 2026-02-01
**ä¸‹æ¬¡éªŒæ”¶**: å®Œæˆ Phase 1+2 å
