╔════════════════════════════════════════════════════════════════╗
║         SPL-3b 深度风险分析报告                                    ║
║         深度扰动测试 + 结构分析 + 风险包络 + 可执行规则           ║
╚════════════════════════════════════════════════════════════════╝
**生成时间**: 2026-02-01 00:16:35
**策略ID**: unknown
**运行ID**: exp_1677b52a
**回测期间**: 2024-01-01 至 2024-06-30
**总收益**: -1.71%

**可追溯性**:
- Git Commit: 0232e5c9
- Config Hash: cfg_1677b52a

---


================================================================================

# 20d 窗口 - 深度风险分析

================================================================================


## 一、Worst-Case 稳定性检验（扰动测试）

**稳定性标签**: Stable


### 扰动测试详情

| 扰动类型 | 扰动值 | 原始收益 | 扰动后收益 | 差异 | 同一窗口 | 在Top-K |
|----------|--------|----------|------------|------|----------|---------|
| replay_order | +0.0% | -27.24% | -27.24% | +0.00% | ✓ | ✓ |
| cost_epsilon | +1.0% | -27.24% | -27.51% | -0.27% | ✓ | ✓ |
| cost_epsilon | -1.0% | -27.24% | -26.97% | +0.27% | ✓ | ✓ |
| capital_epsilon | +1.0% | -27.24% | -26.97% | +0.27% | ✓ | ✓ |
| capital_epsilon | -1.0% | -27.24% | -27.51% | -0.28% | ✓ | ✓ |

### 判断标准

- **Stable**: 扰动后最坏窗口仍在同一时间区间（±2天）
- **Weakly Stable**: 扰动后最坏窗口在原始Top-K中
- **Fragile**: 扰动后最坏窗口不在Top-K中

## 二、Worst-Case 结构确认

**风险类型**: 结构性风险 (Structural Risk Pattern)


### 形态指标

| 指标 | 数值 | 说明 |
|------|------|------|
| 平均MDD | 2.18% | Top-K平均 |
| MDD标准差 | 0.34% | |
| MDD变异系数 | 0.155 | <0.3为稳定 |
| 形态相似度 | 0.753 | >0.7为高度相似 |
| 回撤曲线相关性 | 1.000 | |
| 形态一致性 | 1.000 | |

### Top-K 最坏窗口

| 排名 | 窗口ID | 收益 | MDD | 回撤形态 |
|------|--------|------|-----|----------|
| 1 | exp_1677b52a_20d_104 |  -27.24% |   1.9% | slow_recovery |
| 2 | exp_1677b52a_20d_103 |  -26.31% |   1.9% | slow_recovery |
| 3 | exp_1677b52a_20d_102 |  -25.03% |   2.0% | slow_recovery |
| 4 | exp_1677b52a_20d_101 |  -24.06% |   2.3% | slow_recovery |
| 5 | exp_1677b52a_20d_100 |  -22.27% |   2.8% | slow_recovery |
## 三、Worst-Case Envelope（风险边界）

## 风险包络 - unknown (20d)

**样本数**: 6
**扰动类型**: replay_order, cost_epsilon, cost_epsilon, capital_epsilon, capital_epsilon
**置信水平**: 95%

### Worst-Case Return 分位数
| 分位数 | 数值 | 说明 |
|--------|------|------|
| P50    |  -27.24% | 中位数 |
| P75    |  -27.04% | |
| P90    |  -26.97% | |
| P95    |  -26.97% | 95%置信边界 |
| P99    |  -26.97% | 99%置信边界 |
| 原始值 |  -27.24% | 未扰动 |

### Worst-Case MDD 分位数
| 分位数 | 数值 | 说明 |
|--------|------|------|
| P50    |   1.93% | 中位数 |
| P75    |   1.93% | |
| P90    |   1.94% | |
| P95    |   1.94% | 95%置信边界 |
| P99    |   1.94% | 99%置信边界 |
| 原始值 |   1.93% | 未扰动 |

### 回撤持续时间 分位数
| 分位数 | 天数 | 说明 |
|--------|------|------|
| P50    |   4.0 | 中位数 |
| P75    |   4.0 | |
| P90    |   4.0 | |
| P95    |   4.0 | 95%置信边界 |
| P99    |   4.0 | 99%置信边界 |
| 原始值 |   4.0 | 未扰动 |

## 四、可执行风险规则

## 可执行风险规则 - unknown

**规则总数**: 3

### 启停规则 (Gating)

#### 规则 #1: 低稳定性暂停交易

- **规则ID**: unknown_stability_gating
- **适用范围**: strategy
- **触发条件**: `stability_score < 30.0`
- **风险类型**: 低稳定性风险
- **证据来源**: 稳定性分析
- **证据数值**: 5.268820897136237

**描述**: 策略稳定性评分 5.3/100 低于阈值30。策略在不同窗口下表现极不稳定，建议暂停使用。

**伪代码**:
```python
if stability_score < 30.0:
    # 执行相应动作
    pause_trading()
```

### 降仓规则 (Position Reduction)

#### 规则 #1: 极端亏损降仓

- **规则ID**: unknown_return_reduction
- **适用范围**: window
- **触发条件**: `window_return < -0.1`
- **风险类型**: 极端收益风险
- **证据来源**: 风险包络 (P95)
- **证据数值**: -0.26965898198019805

**描述**: 在20d窗口下，P95最坏收益为-26.97%。当窗口收益低于-10%时，建议将仓位降低50%。

**伪代码**:
```python
if window_return < -0.1:
    # 执行相应动作
    reduce_position(0.5)  # 降低50%仓位
```

### 禁用规则 (Disable)

#### 规则 #1: 结构性风险禁用

- **规则ID**: unknown_regime_disable
- **适用范围**: regime
- **触发条件**: `market_regime < 0.0`
- **风险类型**: 结构性风险
- **证据来源**: 结构分析
- **证据数值**: 0.7533541170645652

**描述**: 策略表现出结构性风险（形态相似度0.75）。Top-K最坏窗口高度相似，建议在震荡市场（ADX < 25）时禁用该策略。

**伪代码**:
```python
if market_regime < 0.0:
    # 执行相应动作
    disable_strategy()
```


================================================================================

# 60d 窗口 - 深度风险分析

================================================================================


## 一、Worst-Case 稳定性检验（扰动测试）

**稳定性标签**: Stable


### 扰动测试详情

| 扰动类型 | 扰动值 | 原始收益 | 扰动后收益 | 差异 | 同一窗口 | 在Top-K |
|----------|--------|----------|------------|------|----------|---------|
| replay_order | +0.0% | 18.99% | 18.99% | +0.00% | ✓ | ✓ |
| cost_epsilon | +1.0% | 18.99% | 19.18% | +0.19% | ✓ | ✓ |
| cost_epsilon | -1.0% | 18.99% | 18.80% | -0.19% | ✓ | ✓ |
| capital_epsilon | +1.0% | 18.99% | 18.81% | -0.19% | ✓ | ✓ |
| capital_epsilon | -1.0% | 18.99% | 19.19% | +0.19% | ✓ | ✓ |

### 判断标准

- **Stable**: 扰动后最坏窗口仍在同一时间区间（±2天）
- **Weakly Stable**: 扰动后最坏窗口在原始Top-K中
- **Fragile**: 扰动后最坏窗口不在Top-K中

## 二、Worst-Case 结构确认

**风险类型**: 结构性风险 (Structural Risk Pattern)


### 形态指标

| 指标 | 数值 | 说明 |
|------|------|------|
| 平均MDD | 4.83% | Top-K平均 |
| MDD标准差 | 0.01% | |
| MDD变异系数 | 0.002 | <0.3为稳定 |
| 形态相似度 | 0.952 | >0.7为高度相似 |
| 回撤曲线相关性 | 1.000 | |
| 形态一致性 | 1.000 | |

### Top-K 最坏窗口

| 排名 | 窗口ID | 收益 | MDD | 回撤形态 |
|------|--------|------|-----|----------|
| 1 | exp_1677b52a_60d_64 |   18.99% |   4.8% | slow_recovery |
| 2 | exp_1677b52a_60d_63 |   22.54% |   4.8% | slow_recovery |
| 3 | exp_1677b52a_60d_62 |   26.06% |   4.8% | slow_recovery |
| 4 | exp_1677b52a_60d_61 |   28.62% |   4.8% | slow_recovery |
| 5 | exp_1677b52a_60d_60 |   31.39% |   4.8% | slow_recovery |
## 三、Worst-Case Envelope（风险边界）

## 风险包络 - unknown (60d)

**样本数**: 6
**扰动类型**: replay_order, cost_epsilon, cost_epsilon, capital_epsilon, capital_epsilon
**置信水平**: 95%

### Worst-Case Return 分位数
| 分位数 | 数值 | 说明 |
|--------|------|------|
| P50    |   18.99% | 中位数 |
| P75    |   19.14% | |
| P90    |   19.18% | |
| P95    |   19.18% | 95%置信边界 |
| P99    |   19.19% | 99%置信边界 |
| 原始值 |   18.99% | 未扰动 |

### Worst-Case MDD 分位数
| 分位数 | 数值 | 说明 |
|--------|------|------|
| P50    |   4.82% | 中位数 |
| P75    |   4.82% | |
| P90    |   4.84% | |
| P95    |   4.85% | 95%置信边界 |
| P99    |   4.86% | 99%置信边界 |
| 原始值 |   4.82% | 未扰动 |

### 回撤持续时间 分位数
| 分位数 | 天数 | 说明 |
|--------|------|------|
| P50    |  38.0 | 中位数 |
| P75    |  38.0 | |
| P90    |  38.0 | |
| P95    |  38.0 | 95%置信边界 |
| P99    |  38.0 | 99%置信边界 |
| 原始值 |  38.0 | 未扰动 |

## 四、可执行风险规则

## 可执行风险规则 - unknown

**规则总数**: 3

### 启停规则 (Gating)

#### 规则 #1: 低稳定性暂停交易

- **规则ID**: unknown_stability_gating
- **适用范围**: strategy
- **触发条件**: `stability_score < 30.0`
- **风险类型**: 低稳定性风险
- **证据来源**: 稳定性分析
- **证据数值**: 5.268820897136237

**描述**: 策略稳定性评分 5.3/100 低于阈值30。策略在不同窗口下表现极不稳定，建议暂停使用。

**伪代码**:
```python
if stability_score < 30.0:
    # 执行相应动作
    pause_trading()
```

#### 规则 #2: 持续回撤暂停

- **规则ID**: unknown_duration_gating
- **适用范围**: window
- **触发条件**: `drawdown_duration > 10.0`
- **风险类型**: 持续回撤风险
- **证据来源**: 风险包络 (P95)
- **证据数值**: 38.0

**描述**: 在60d窗口下，P95回撤持续时间为38.0天。当回撤持续超过10天时，建议暂停交易。

**伪代码**:
```python
if drawdown_duration > 10.0:
    # 执行相应动作
    pause_trading()
```

### 禁用规则 (Disable)

#### 规则 #1: 结构性风险禁用

- **规则ID**: unknown_regime_disable
- **适用范围**: regime
- **触发条件**: `market_regime < 0.0`
- **风险类型**: 结构性风险
- **证据来源**: 结构分析
- **证据数值**: 0.9521711779839052

**描述**: 策略表现出结构性风险（形态相似度0.95）。Top-K最坏窗口高度相似，建议在震荡市场（ADX < 25）时禁用该策略。

**伪代码**:
```python
if market_regime < 0.0:
    # 执行相应动作
    disable_strategy()
```

## 五、综合结论

### 稳定性总评

| 窗口长度 | 稳定性标签 | 风险类型 | 规则数量 |
|----------|------------|----------|----------|
| 20d | Stable | structural | 3 |
| 60d | Stable | structural | 3 |

### 适用性评估

🔴 **策略风险较高，必须启用完整风控机制**


---

## 六、元数据与可复现性

### 分析配置

- 扰动类型数: 5
- 分析窗口: 0.0 ε
- 置信水平: 95%

### 可复现性审计

本报告可完全复现：

```bash
# 检出代码版本
git checkout 0232e5c9

# 使用相同配置
python -c "
from analysis import DeepAnalysisReportGenerator, load_replay_outputs
replays = load_replay_outputs('runs')
replay = [r for r in replays if r.run_id == 'exp_1677b52a'][0]
generator = DeepAnalysisReportGenerator()
report = generator.generate_full_report(replay)
print(report)
"
```

---

*本报告由 MKCS SPL-3b 深度风险分析系统自动生成*
