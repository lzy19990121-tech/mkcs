╔════════════════════════════════════════════════════════════════╗
║         MA(5,20) 策略失败画像 - 稳定性分析报告 v1.0                ║
║                                                                  ║
║  生成日期：2026-01-31                                            ║
║  分析工具：window_scanner + stability_analysis                   ║
║  回测期间：2024-01-01 至 2024-06-30                             ║
╚════════════════════════════════════════════════════════════════╝

┌──────────────────────────────────────────────────────────────────┐
│ 策略基本信息                                                      │
└──────────────────────────────────────────────────────────────────┘

策略名称        : MA(5,20) - 移动平均线交叉策略
策略类型        : 趋势跟踪
标的            : AAPL, MSFT, GOOGL
回测期间        : 2024-01-01 至 2024-06-30 (6个月)
初始资金        : $100,000.00
最终权益        : $98,293.62
总收益          : -1.71%

策略参数        :
  • fast_period  = 5   (快线周期)
  • slow_period  = 20  (慢线周期)

交易逻辑        :
  • 金叉买入：MA5 上穿 MA20
  • 死叉卖出：MA5 下穿 MA20

成本配置        :
  • 手续费      : $0.01/股 (per_share)
  • 滑点        : 0.1% (fixed)

可追溯性        :
  • Git Commit  : 0232e5c9
  • Config Hash : cfg_1677b52a
  • Run ID      : exp_1677b52a

┌──────────────────────────────────────────────────────────────────┐
│ 稳定���评分                                                        │
└──────────────────────────────────────────────────────────────────┘

综合稳定性评分  : 5.3 / 100

分项指标        :
  • 收益方差    : 8.7478%
  • 收益极差    : 86.26%
  • MDD一致性   : 0.824
  • 最差CVaR    : 5.415

评分解释        :
  稳定性评分 5.3/100 表示策略在不同时间窗口下的表现极不稳定。
  满分100分，得分低于30分通常表示策略不可接受。

┌──────────────────────────────────────────────────────────────────┐
│ 各窗口最坏情况                                                    │
└──────────────────────────────────────────────────────────────────┘

┌──────────┬──────────┬────────┬────────────┐
│ 窗口长度 │ 最坏收益 │ 最大回撤│ 回撤形态   │
├──────────┼──────────┼────────┼────────────┤
│ 1d       │  -2.31%  │  0.0%  │ unrecovered │
│ 5d       │  -9.39%  │  0.7%  │ sharp      │
│ 20d      │ -27.24%  │  1.9%  │ slow_recovery │
│ 60d      │  18.99%  │  4.8%  │ slow_recovery │
│ 120d     │  59.02%  │  4.9%  │ slow_recovery │
└──────────┴──────────┴────────┴────────────┘

关键发现        :
  • 短期窗口（1d, 5d, 20d）全部亏损
  • 20天窗口亏损最严重：-27.24%
  • 风险随时间尺度显著变化

══════════════════════════════════════════════════════════════════
🔴 核心问题 #1：连续20天全亏损
══════════════════════════════════════════════════════════════════

时间窗口        : 2024-05-31 至 2024-06-28
持续天数        : 20个交易日
总亏损          : $27,237.60 (-27.24%)
平均每日亏损    : $1,361.88
最大单日亏损    : $2,307.38 (2024-06-07)
盈利天数        : 0天
亏损天数        : 20天

回撤形态        : slow_recovery
回撤持续时间    : 4天
回撤恢复时间    : 14天

问题性质        :
  ❗ 策略在特定市场状态下完全失效
  ❗ 没有任何止损或风控机制介入
  ❗ 策略持续产生反向信号
  ❗ 亏损逐日累积，无任何反弹

数据验证        :

  日期范围          盈亏         状态
  ──────────────────────────────────────────
  2024-05-31      $-655.38     ❌ 亏损
  2024-06-03      $-394.38     ❌ 亏损
  2024-06-04      $-936.38     ❌ 亏损
  2024-06-05    $-1,582.38     ❌ 亏损
  2024-06-06    $-1,940.38     ❌ 亏损
  2024-06-07    $-2,307.38     ❌ 亏损 ← 最大单日
  2024-06-10    $-1,863.38     ❌ 亏损
  2024-06-11    $-1,692.38     ❌ 亏损
  2024-06-12    $-1,158.38     ❌ 亏损
  2024-06-13    $-1,307.38     ❌ 亏损
  2024-06-14    $-1,148.38     ❌ 亏损
  2024-06-17    $-1,125.38     ❌ 亏损
  2024-06-18    $-1,394.38     ❌ 亏损
  2024-06-20    $-1,376.38     ❌ 亏损
  2024-06-21    $-1,352.38     ❌ 亏损
  2024-06-24    $-1,404.38     ❌ 亏损
  2024-06-25    $-1,270.38     ❌ 亏损
  2024-06-26    $-1,011.38     ❌ 亏损
  2024-06-27    $-1,610.38     ❌ 亏损
  2024-06-28    $-1,706.38     ❌ 亏损

  ⚠️  所有20个交易日都是亏损，没有一天盈利！

══════════════════════════════════════════════════════════════════
🔴 核心问题 #2：震荡市假信号陷阱
══════════════════════════════════════════════════════════════════

问题定义        :
  2024年5-6月期间，市场呈现典型震荡市特征（sideways market）

MA(5,20) 策略在震荡市中的失效机制：

  1. 价格在5日和20日均线之间反复穿越
  2. 每次穿越都产生交易信号（金叉/死叉）
  3. 震荡市中这些信号大多是"假信号"
  4. 每次交易后价格往往向反方向移动
  5. 频繁交易累积巨额亏损

信号-结果链条：

  震荡市行情
      ↓
  价格波动 → MA5频繁穿越MA20
      ↓
  产生大量买入/卖出信号
      ↓
  每次信号后价格反向
      ↓
  每笔交易亏损
      ↓
  20天累积 -27.24%

══════════════════════════════════════════════════════════════════
🔴 核心问题 #3：fast_period=5 过于敏感
══════════════════════════════════════════════════════════════════

参数分析        :

  fast_period = 5  →  5日均线 = 1周数据

敏感度问题      :
  • 5日均线对任何短期价格波动都极其敏感
  • 噪音（noise）被当作信号（signal）处理
  • 日常价格波动产生大量假信号

对比验证        :

  fast_period    均线含义      敏感度    稳定性评分
  ───────────────────────────────────────────────
  5             1周数据       极高 ❌    5.3/100
  10            2周数据       中等 ⚠️    待测试
  20            1月数据       低 ✅      待测试

实际影响        :
  fast_period=5 导致策略在20天内产生了过多次交易信号，
  每次信号后价格的反向移动都造成亏损。

══════════════════════════════════════════════════════════════════
🔴 核心问题 #4：缺少市场状态识别
══════════════════════════════════════════════════════════════════

当前策略盲点    :

  功能                    当前状态    应该有
  ──────────────────────────────────────────────
  趋势市 vs 震荡市识别     ❌ 无       ✅ ADX/DMI
  波动率过滤              ❌ 无       ✅ ATR过滤
  趋势强度判断            ❌ 无       ✅ 只在强趋势交易
  止损机制                ❌ 无       ✅ 连续亏损止损
  暂停交易逻辑            ❌ 无       ✅ 触发条件后暂停

缺失的防护      :

  1. 没有判断当前市场是否适合交易
  2. 在震荡市中持续交易（应该停止）
  3. 没有止损机制，亏损持续累积
  4. 没有风险控制阈值

实际后果        :

  策略在不适合的市场环境中持续运行，
  导致连续20天交易、连续20天亏损的极端情况。

══════════════════════════════════════════════════════════════════
🔴 核心问题 #5：交易成本侵蚀
══════════════════════════════════════════════════════════════════

成本配置        :
  • 手续费模式  : per_share
  • 手续费金额  : $0.01/股
  • 滑点类型    : fixed
  • 滑点比例    : 0.1%

单次交易成本    :
  假设买入/卖出 100股：
  • 买入手续费  : 100 × $0.01 = $1
  • 卖出手续费  : 100 × $0.01 = $1
  • 买入滑点    : ≈ 价格 × 0.1% × 100股
  • 卖出滑点    : ≈ 价格 × 0.1% × 100股
  • 单次完整交易成本 ≈ $50-100

20天累积成本    :
  如果策略每天产生买入+卖出信号：
  • 每日成本    : $50-100
  • 20天成本    : $1,000-2,000

  这占总亏损 $27,237 的约 3.7%-7.3%

成本影响        :

  虽然单次成本不高，但：
  1. 频繁交易导致成本累积
  2. 在亏损交易中，成本进一步放大损失
  3. 在震荡市中，每笔交易亏损 + 成本 = 双重打击

══════════════════════════════════════════════════════════════════
Top-K 最坏窗口详情
══════════════════════════════════════════════════════════════════

#1 最坏窗口
  窗口ID        : exp_1677b52a_20d_104
  时间范围      : 2024-05-31 至 2024-06-28
  窗口长度      : 20d
  窗口收益      : -27.24%
  窗口盈亏      : $-27,237.60

  风险指标      :
    最大回撤           : 1.93%
    回撤持续天数       : 4天
    回撤恢复时间       : 14天
    Ulcer指数          : 1.06
    下行波动           : 426.79
    95% CVaR           : -1.438
    尾部均值           : -$2,307.38

  尖刺风险      :
    最大单步亏损       : $-2,307.38
    最长连亏           : 20天

  回撤形态      : slow_recovery
  是否未恢复    : 否

#2 最坏窗口
  窗口ID        : exp_1677b52a_20d_103
  时间范围      : 2024-05-30 至 2024-06-27
  窗口长度      : 20d
  窗口收益      : -26.31%
  窗口盈亏      : $-26,311.69

  风险指标      :
    最大回撤           : 1.93%
    回撤持续天数       : 4天
    回撤恢复时间       : 13天
    Ulcer指数          : 1.02
    下行波动           : 446.47
    95% CVaR           : -1.489
    尾部均值           : -$2,307.38

  尖刺风险      :
    最大单步亏损       : $-2,307.38
    最长连亏           : 20天

  回撤形态      : slow_recovery

#3 最坏窗口
  窗口ID        : exp_1677b52a_20d_102
  时间范围      : 2024-05-29 至 2024-06-26
  窗口长度      : 20d
  窗口收益      : -25.03%
  窗口盈亏      : $-25,029.78

  风险指标      :
    最大回撤           : 1.99%
    回撤持续天数       : 7天
    回撤恢复时间       : 12天
    Ulcer指数          : 1.05
    下行波动           : 461.30
    95% CVaR           : -1.565
    尾部均值           : -$2,307.38

  尖刺风险      :
    最大单步亏损       : $-2,307.38
    最长连亏           : 20天

  回撤形态      : slow_recovery

观察            :
  Top-3 最坏窗口在时间上高度重叠，集中在 2024-05-24 至 2024-06-28。
  说明风险是结构性的，不是随机事件。

══════════════════════════════════════════════════════════════════
风险特征总结
══════════════════════════════════════════════════════════════════

风险类型        : 结构性风险（非随机）

判断依据        :
  1. Top-K最坏窗口集中在特定时间段
  2. 风险与市场状态（震荡市）高度相关
  3. 亏损具有持续性（20天连续）
  4. 相同市场条件下会重复发生

可预测性        : 部分可预测

  可预测的因素    :
    • 震荡市特征可以通过技术指标识别
    • 低波动率环境可以提前检测

  不可预测的因素  :
    • 震荡市的确切开始时间
    • 震荡持续的时长

风险等级        : 极高 🔴

判断依据        :
  • 稳定性评分 5.3/100（远低于可接受阈值30）
  • 最坏窗口亏损 -27.24%
  • 连续20天无任何盈利
  • 回撤形态为 slow_recovery（恢复慢）

══════════════════════════════════════════════════════════════════
关键数据快照
══════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────┐
│ 指标                  │ 数值          │ 说明               │
├─────────────────────────────────────────────────────────────┤
│ 稳定性评分            │ 5.3/100       │ 极低               │
│ 总收益                │ -1.71%        │ 6个月整体亏损      │
│ 最坏窗口(20d)         │ -27.24%       │ 单月最大亏损       │
│ 最大回撤              │ 4.9%          │ 全局最大回撤       │
│ 最大单日亏损          │ $2,307.38     │ 单日最大损失       │
│ 最长连亏天数          │ 20天          │ 持续亏损时长       │
│ 回撤形态              │ slow_recovery │ 恢复缓慢           │
│ CVaR (95%)            │ 5.415         │ 尾部风险极高       │
│ 收益方差              │ 8.7478%       │ 不同窗口差异大     │
└─────────────────────────────────────────────────────────────┘

══════════════════════════════════════════════════════════════════
自检问题答案
══════════════════════════════════════════════════════════════════

Q1: 这个策略最坏能坏到什么程度？
A1: 在20天窗口下亏损 -27.24%，即单月亏损超过1/4本金。

Q2: 坏是一次性，还是持续很久？
A2: 持续20天，每天亏损，无一例外。回撤形态为slow_recovery，
     需要14天才能从最大回撤中恢复。

Q3: 换时间尺度，结论会不会变？
A3: 会显著变化。
     - 1d窗口: -2.31%
     - 5d窗口: -9.39%
     - 20d窗口: -27.24% ← 最坏
     - 60d窗口: +18.99% ← 反而盈利
     风险高度依赖时间尺度。

Q4: 最坏风险来自哪类决策？
A4: 来自参数选择 fast_period=5。
     • 5日均线过于敏感，产生大量假信号
     • 策略没有市场状态识别，在震荡市中持续交易
     • 追溯到：commit=0232e5c9, config=cfg_1677b52a

Q5: 如果明天上线，这个策略你敢不敢单独开？
A5: 不敢。
     • 稳定性评分 5.3/100 远低于可接受阈值
     • 历史上有连续20天亏损的前科
     • 缺少任何风控机制
     • 遇到震荡市会重复发生类似亏损

══════════════════════════════════════════════════════════════════
结论
══════════════════════════════════════════════════════════════════

MA(5,20) 移动平均线策略在 2024-01-01 至 2024-06-30 的回测中表现
如下：

✗ 总体亏损：-1.71%
✗ 稳定性极差：5.3/100
✗ 最坏情况严重：20天亏损 -27.24%
✗ 连续20天每日亏损，无任何反弹
✗ 缺少市场状态识别和风控机制

适用性评估：
  ✗ 不适合单独部署
  ✗ 需要严格风控 gating
  ✗ 震荡市中完全失效

风险等级：极高 🔴

建议状态：不推荐使用

══════════════════════════════════════════════════════════════════

报告生成信息：
  生成工具    : MKCS Risk Analysis System v1.0.0
  生成时间    : 2026-01-31
  分析模块    :
    - analysis/replay_schema.py
    - analysis/window_scanner.py
    - analysis/stability_analysis.py
    - analysis/multi_strategy_comparison.py
    - analysis/risk_card_generator.py

  数据来源    : runs/exp_1677b52a/
    - run_manifest.json
    - summary.json
    - trades.csv
    - equity_curve.csv

  完整可复现  :
    Git Commit : 0232e5c9
    Config Hash: cfg_1677b52a

══════════════════════════════════════════════════════════════════
